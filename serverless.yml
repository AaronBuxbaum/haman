service: haman-broadway-lottery

provider:
  name: aws
  runtime: nodejs20.x
  region: us-east-1
  stage: ${opt:stage, 'dev'}
  memorySize: 1024
  timeout: 300
  environment:
    OPENAI_API_KEY: ${env:OPENAI_API_KEY}
    NODE_ENV: production

functions:
  applyLotteries:
    handler: dist/handler.handler
    description: Apply to Broadway lotteries for all users
    events:
      # Run daily at 9 AM EST (most lotteries open around this time)
      - schedule:
          rate: cron(0 14 * * ? *)
          enabled: true
          description: Apply to Broadway lotteries daily at 9 AM EST
      # Also run at 11 AM EST (backup time for late-opening lotteries)
      - schedule:
          rate: cron(0 16 * * ? *)
          enabled: true
          description: Apply to Broadway lotteries at 11 AM EST

plugins:
  - serverless-offline

package:
  patterns:
    - '!node_modules/**'
    - '!src/**'
    - 'dist/**'
    - 'package.json'

custom:
  serverless-offline:
    httpPort: 3000
